// Copyright (C) 2013 The Android Open Source Project
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//      http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

cc_library_static {
    name: "libdw",
    host_supported: true,
    vendor_available: true,

    srcs:  [
        "dwarf_begin.c",
        "dwarf_begin_elf.c",
        "dwarf_end.c",
        "dwarf_getelf.c",
        "dwarf_getpubnames.c",
        "dwarf_getabbrev.c",
        "dwarf_tag.c",
        "dwarf_error.c",
        "dwarf_nextcu.c",
        "dwarf_diename.c",
        "dwarf_offdie.c",
        "dwarf_attr.c",
        "dwarf_formstring.c",
        "dwarf_abbrev_hash.c",
        "dwarf_sig8_hash.c",
        "dwarf_attr_integrate.c",
        "dwarf_hasattr_integrate.c",
        "dwarf_child.c",
        "dwarf_haschildren.c",
        "dwarf_formaddr.c",
        "dwarf_formudata.c",
        "dwarf_formsdata.c",
        "dwarf_lowpc.c",
        "dwarf_entrypc.c",
        "dwarf_haspc.c",
        "dwarf_highpc.c",
        "dwarf_ranges.c",
        "dwarf_formref.c",
        "dwarf_formref_die.c",
        "dwarf_siblingof.c",
        "dwarf_dieoffset.c",
        "dwarf_cuoffset.c",
        "dwarf_diecu.c",
        "dwarf_hasattr.c",
        "dwarf_hasform.c",
        "dwarf_whatform.c",
        "dwarf_whatattr.c",
        "dwarf_bytesize.c",
        "dwarf_arrayorder.c",
        "dwarf_bitsize.c",
        "dwarf_bitoffset.c",
        "dwarf_srclang.c",
        "dwarf_getabbrevtag.c",
        "dwarf_getabbrevcode.c",
        "dwarf_abbrevhaschildren.c",
        "dwarf_getattrcnt.c",
        "dwarf_getabbrevattr.c",
        "dwarf_getsrclines.c",
        "dwarf_getsrc_die.c",
        "dwarf_getscopes.c",
        "dwarf_getscopes_die.c",
        "dwarf_getscopevar.c",
        "dwarf_linesrc.c",
        "dwarf_lineno.c",
        "dwarf_lineaddr.c",
        "dwarf_linecol.c",
        "dwarf_linebeginstatement.c",
        "dwarf_lineendsequence.c",
        "dwarf_lineblock.c",
        "dwarf_lineprologueend.c",
        "dwarf_lineepiloguebegin.c",
        "dwarf_lineisa.c",
        "dwarf_linediscriminator.c",
        "dwarf_lineop_index.c",
        "dwarf_onesrcline.c",
        "dwarf_formblock.c",
        "dwarf_getsrcfiles.c",
        "dwarf_filesrc.c",
        "dwarf_getsrcdirs.c",
        "dwarf_getlocation.c",
        "dwarf_getstring.c",
        "dwarf_offabbrev.c",
        "dwarf_getaranges.c",
        "dwarf_onearange.c",
        "dwarf_getarangeinfo.c",
        "dwarf_getarange_addr.c",
        "dwarf_getattrs.c",
        "dwarf_formflag.c",
        "dwarf_getmacros.c",
        "dwarf_macro_getparamcnt.c",
        "dwarf_macro_opcode.c",
        "dwarf_macro_param.c",
        "dwarf_macro_param1.c",
        "dwarf_macro_param2.c",
        "dwarf_macro_getsrcfiles.c",
        "dwarf_addrdie.c",
        "dwarf_getfuncs.c",
        "dwarf_decl_file.c",
        "dwarf_decl_line.c",
        "dwarf_decl_column.c",
        "dwarf_func_inline.c",
        "dwarf_getsrc_file.c",
        "libdw_findcu.c",
        "libdw_form.c",
        "libdw_alloc.c",
        "libdw_visit_scopes.c",
        "dwarf_entry_breakpoints.c",
        "dwarf_next_cfi.c",
        "cie.c",
        "fde.c",
        "cfi.c",
        "frame-cache.c",
        "dwarf_frame_info.c",
        "dwarf_frame_cfa.c",
        "dwarf_frame_register.c",
        "dwarf_cfi_addrframe.c",
        "dwarf_getcfi.c",
        "dwarf_getcfi_elf.c",
        "dwarf_cfi_end.c",
        "dwarf_aggregate_size.c",
        "dwarf_getlocation_implicit_pointer.c",
        "dwarf_getlocation_die.c",
        "dwarf_getlocation_attr.c",
        "dwarf_getalt.c",
        "dwarf_setalt.c",
        "dwarf_cu_getdwarf.c",
        "dwarf_cu_die.c",
        "dwarf_peel_type.c",
    ],

    cflags: [
        "-DHAVE_CONFIG_H",
        "-std=gnu99",
        "-D_GNU_SOURCE",
        "-Werror",
        // to suppress the "pointer of type ‘void *’ used in arithmetic" warning
        "-Wno-pointer-arith",
    ],

    static_libs: [
        "libz",
        "libelf_headers",
    ],

    export_include_dirs: [".",],
    include_dirs: [ "external/elfutils/libelf", ],
    target: {
        darwin: {
            enabled: false,
        },
        android: {
            cflags: [
                "-D_FILE_OFFSET_BITS=64",
                "-include AndroidFixup.h",
            ],
        },
    },
}
